# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

name: Deploy to Firebase Hosting on merge
on:
  push:
    branches:
      - main
jobs:
  build_and_deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-java@v1
        with:
          java-version: '12.x'
      - uses: subosito/flutter-action@v1
      - name: 'Create .env file'
        run: |
          echo "URL=${{ secrets.SUPABASE_URL }}" > .env
          echo "ANONKEY=${{ secrets.SUPABASE_ANON_KEY }}" >> .env
          echo "API_BASE_URL=${{ secrets.API_BASE_URL }}" >> .env
          echo "API_TIMEOUT=${{ secrets.API_TIMEOUT }}" >> .env
          echo "APP_NAME=Oftal Web" >> .env
          echo "APP_VERSION=0.1.0" >> .env
          echo "DEBUG_MODE=false" >> .env
          echo "Created .env file with:"
          cat .env
      - name: 'Run flutter pub get'
        run: flutter pub get
      - name: 'Verify environment variables'
        run: |
          echo "Checking environment variables:"
          echo "URL: ${{ secrets.SUPABASE_URL }}"
          echo "ANONKEY: ${{ secrets.SUPABASE_ANON_KEY }}"
      - name: 'Build Web App'
        run: flutter build web
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_ANON_KEY: ${{ secrets.SUPABASE_ANON_KEY }}
      - uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: ${{ secrets.GITHUB_TOKEN }}
          firebaseServiceAccount: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_OFTAL_WEB }}
          channelId: live
          projectId: oftal-web
